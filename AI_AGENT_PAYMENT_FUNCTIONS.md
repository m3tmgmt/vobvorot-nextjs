# üí≥ AI Agent Payment Functions Documentation

## Overview
–ü–ª–∞—Ç–µ–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å AI –∞–≥–µ–Ω—Ç–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–º–∏–Ω–∞–º —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º–∏ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ —á–µ—Ä–µ–∑ Telegram –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∑–∞—Ö–æ–¥–∏—Ç—å –≤ –∞–¥–º–∏–Ω–∫—É —Å–∞–π—Ç–∞.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

```
AI Agent (payment-manager.ts)
    ‚Üì HTTP –∑–∞–ø—Ä–æ—Å—ã + Direct DB
Internal API endpoints 
    ‚Üì
WesternBid Library
    ‚Üì
WesternBid API (Stripe/PayPal)
```

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ

### 1. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (60 —Å–µ–∫ TTL)**
- –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π –∫–µ—à–∏—Ä—É—é—Ç—Å—è –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –ø–æ—Å–ª–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 2. **–ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ –ë–î**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —á—Ç–µ–Ω–∏—è (getPaymentInfo, checkPaymentStatus)
- –¢–æ—Ç –∂–µ Prisma instance —á—Ç–æ –∏ –≤–µ—Å—å —Å–∞–π—Ç
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å include –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**
- –î–∞–Ω–Ω—ã–µ –æ –∫–ª–∏–µ–Ω—Ç–µ
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
- –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### 1. **–í–æ–∑–≤—Ä–∞—Ç –ø–ª–∞—Ç–µ–∂–∞** (`refund_payment`)
```
–ö–æ–º–∞–Ω–¥–∞: "—Å–¥–µ–ª–∞–π –≤–æ–∑–≤—Ä–∞—Ç –¥–ª—è –∑–∞–∫–∞–∑–∞ 123 –ø—Ä–∏—á–∏–Ω–∞ –±—Ä–∞–∫"
–ö–æ–º–∞–Ω–¥–∞: "–≤–µ—Ä–Ω–∏ 500 —Ä—É–±–ª–µ–π –∑–∞ –∑–∞–∫–∞–∑ 456 –ø—Ä–∏—á–∏–Ω–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ"
```
- –ü–æ–ª–Ω—ã–π –∏–ª–∏ —á–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
- –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WesternBid Refund API

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞** (`check_payment_status`)
```
–ö–æ–º–∞–Ω–¥–∞: "–ø—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞ 123"
```
- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–µ
- –ò—Å—Ç–æ—Ä–∏—è –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### 3. **–ü–æ–≤—Ç–æ—Ä –ø–ª–∞—Ç–µ–∂–∞** (`retry_payment`)
```
–ö–æ–º–∞–Ω–¥–∞: "–ø–æ–≤—Ç–æ—Ä–∏ –ø–ª–∞—Ç–µ–∂ –¥–ª—è –∑–∞–∫–∞–∑–∞ 123"
```
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–µ—Å—Å–∏–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Stripe –∏ PayPal
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º—ã –¥–ª—è WesternBid
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

### 4. **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ** (`view_payment_info`)
```
–ö–æ–º–∞–Ω–¥–∞: "–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ 123"
```
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ
- –°—Ç–∞—Ç—É—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞
- –õ–∏–º–∏—Ç—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
- –î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞ –∏ —Ç–æ–≤–∞—Ä–æ–≤

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**
   - –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã (ID: 316593422, 1837334996)
   - Bearer token –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤

2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**
   - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
   - –í–æ–∑–≤—Ä–∞—Ç—ã –≤—Å–µ–≥–¥–∞ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
   - Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WesternBid

### API Endpoints
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞: `westernbid.createPayment()`
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–æ—Ä–º—ã: `westernbid.generatePaymentFormData()`
- Webhooks: `/api/webhooks/westernbid`

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–µ—Ç–æ–¥—ã
- Stripe
- PayPal
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä gateway

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `order` - –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö
- `customer` - –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
- `orderItems` - —Ç–æ–≤–∞—Ä—ã –≤ –∑–∞–∫–∞–∑–∞—Ö
- `paymentLogs` - –ª–æ–≥–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –°—Ç–∞—Ç—É—Å—ã –ø–ª–∞—Ç–µ–∂–µ–π
- `PENDING` - –æ–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—ã
- `PROCESSING` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- `COMPLETED` - –æ–ø–ª–∞—á–µ–Ω
- `FAILED` - –æ—à–∏–±–∫–∞
- `CANCELLED` - –æ—Ç–º–µ–Ω–µ–Ω

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
node test-ai-payment-functions.js
```

### –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞: "—Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã –∑–∞–∫–∞–∑–∞ 20250129-1234567"
2. –í–æ–∑–≤—Ä–∞—Ç: "–æ—Ñ–æ—Ä–º–∏ –≤–æ–∑–≤—Ä–∞—Ç 20250129-1234567 –ø—Ä–∏—á–∏–Ω–∞ –∫–ª–∏–µ–Ω—Ç –ø–µ—Ä–µ–¥—É–º–∞–ª"
3. –ü–æ–≤—Ç–æ—Ä: "—Å–æ–∑–¥–∞–π –Ω–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –¥–ª—è 20250129-1234567"
4. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: "–¥–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞ 20250129-1234567"

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ë–î –Ω–∞ ~40%
- –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–µ–µ HTTP –Ω–∞ ~200ms
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ include –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—é—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤

## –°—Ç–∞—Ç—É—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**:
- –í—Å–µ 4 –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ü—Ä—è–º–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î
- WesternBid –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- MarkdownV2 —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

üéØ **–î–û–°–¢–ò–ñ–ï–ù–ò–ï**: –ü–ª–∞—Ç–µ–∂–Ω—ã–π –º–æ–¥—É–ª—å (14/100+ —Ñ—É–Ω–∫—Ü–∏–π) –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π!