# ü§ñ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–Å–¢ –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ TELEGRAM –ë–û–¢–ê

## ‚úÖ –°–¢–ê–¢–£–°: –ë–û–¢ –†–ê–ë–û–¢–ê–ï–¢

### üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´:

1. **–°–∏–º–≤–æ–ª –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Vercel**
   - `TELEGRAM_OWNER_CHAT_ID`: "1837334996,316593422\n"
   - `NEXTAUTH_URL`: "https://vobvorot.com\n"
   - –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∞–¥–º–∏–Ω–æ–≤

2. **CSRF –∑–∞—â–∏—Ç–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ Telegram webhook**
   - Middleware –ø—Ä–æ–≤–µ—Ä—è–ª CSRF —Ç–æ–∫–µ–Ω –¥–ª—è –≤—Å–µ—Ö API endpoints
   - Telegram –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç CSRF —Ç–æ–∫–µ–Ω—ã
   - Webhook –≤–æ–∑–≤—Ä–∞—â–∞–ª 403 Forbidden

### ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –†–ï–®–ï–ù–ò–Ø:

1. **–°–æ–∑–¥–∞–Ω –ø—Ä—è–º–æ–π webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫** `/api/telegram/direct`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç hardcoded –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç env)
   - –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã Telegram API –±–µ–∑ Grammy
   - –ü—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω middleware** –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è Telegram endpoints:
   ```typescript
   const telegramEndpoints = [
     '/api/telegram/webhook',
     '/api/telegram/direct',
     '/api/telegram/test-debug',
     '/api/telegram/test-simple',
     '/api/telegram/webhook-direct'
   ]
   ```

3. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω webhook** –Ω–∞ –Ω–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫:
   ```
   https://vobvorot.com/api/telegram/direct
   ```

### üìã –¢–ï–ö–£–©–ò–ô –§–£–ù–ö–¶–ò–û–ù–ê–õ –ë–û–¢–ê:

**–†–∞–±–æ—Ç–∞—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:**
- `/start` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- `/status` - —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
- `/test` - —Ç–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–π

**–í—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è env):**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã sign
- CRM —Ñ—É–Ω–∫—Ü–∏–∏ (–∑–∞–∫–∞–∑—ã, —Ç–æ–≤–∞—Ä—ã, –∫–ª–∏–µ–Ω—Ç—ã)
- Conversations –∏ sessions Grammy

### üõ†Ô∏è –î–õ–Ø –ü–û–õ–ù–û–ì–û –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–Ø:

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ Vercel:**
   - –ó–∞–π—Ç–∏: https://vercel.com/m3tmgmt-gmailcoms-projects/vobvorot-nextjs/settings/environment-variables
   - –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `TELEGRAM_OWNER_CHAT_ID` - —É–±—Ä–∞—Ç—å \n
   - –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `NEXTAUTH_URL` - —É–±—Ä–∞—Ç—å \n
   
2. **–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:**
   ```bash
   # –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å webhook –æ–±—Ä–∞—Ç–Ω–æ
   curl -X POST https://api.telegram.org/bot7700098378:AAGZ1zZOxiwXbJeknO9SvyN25KvfWQkQNrI/setWebhook \
     -H "Content-Type: application/json" \
     -d '{
       "url": "https://vobvorot.com/api/telegram/webhook",
       "secret_token": "vobvorot_webhook_secret_2025"
     }'
   ```

### üìä –î–ò–ê–ì–ù–û–°–¢–ò–ß–ï–°–ö–ò–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´:

- `/api/telegram/debug` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `/test-bot-webhook.js` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook
- `/restart-bot.js` - –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞

### üöÄ –î–ï–ü–õ–û–ô:
```bash
npx vercel --prod --token yGHkW9HSoepeo4Q8ZnSBEKwn
```

### ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢:
–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤. –î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ CRM —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Vercel.